<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> {{#meta.title}}{{meta.title}} - {{/meta.title}}{{config.site.title}}</title>
    <meta property="og:title" content="{{#meta.title}}{{meta.title}} - {{/meta.title}}{{config.site.title}}" />
    {{#meta.metadata.description}}
    <meta name="description" content="{{meta.metadata.description}}" />
    {{/meta.metadata.description}}
    {{#meta.metadata.refresh}}
    <meta http-equiv="refresh" content="{{meta.metadata.refresh}}" />{{/meta.metadata.refresh}}
    {{#meta.metadata.keywords}}
    <meta name="keywords" content="{{meta.metadata.keywords}}" />{{/meta.metadata.keywords}}
    {{#meta.metadata.author}}
    <meta name="author" content="{{meta.metadata.author}}" />{{/meta.metadata.author}}
    {{#meta.metadata.robots}}
    <meta name="robots" content="{{meta.metadata.robots}}" />{{/meta.metadata.robots}}
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="Generator" content="Csycms (http://csycms.csymapp.com)" />
    <meta property="og:type" content="song" />

    <meta property="og:image" content="{{config.base_url}}/charles-wesley-hymn-690x385.jpg" />
    <meta property="og:url" content="{{url}}" />
    <meta property="og:site_name" content="{{config.site.title}}" />

    <link rel="shortcut icon" href="{{config.base_url}}/favicon.ico">

    <!-- <link rel="stylesheet" href="{{config.base_url}}/styles/uf_style.css"> -->
    <!-- <link rel="stylesheet" href="{{config.base_url}}/styles/cstyle.css"> -->
    <!-- <link rel="stylesheet" href="{{config.base_url}}/styles/theme.css"> -->
    {{#config.rtl_layout}}
    <!-- <link rel="stylesheet" href="{{config.base_url}}/lib/bootstrap-rtl/dist/css/bootstrap-rtl.min.css">
    <link rel="stylesheet" href="{{config.base_url}}/styles/raneto.rtl.css"> -->

    {{/config.rtl_layout}}

    {{{config.analytics}}}
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet"
        type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@^4.0.0/animate.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/quasar@1.15.21/dist/quasar.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{{config.base_url}}/styles/style.css">
    <style>
        :root {
            --q-color-primary: #4D321E;
            --q-color-secondary: #A87A4E;
            --q-color-accent: #C8C0BA;
            --q-color-positive: #21ba45;
            --q-color-negative: #c10015;
            --q-color-info: #31ccec;
            --q-color-warning: #f2c037;
            --q-color-dark: #1d1d1d;
        }
    </style>
</head>

<body class="">
    <div class="absolute-center full-width full-height bg-white" style="z-index:-1"></div>
    <div class="bg-text text-white bg-red absolute-top"
        style="z-index:-2;height:10px; width:10px; text-decoration:none; font-size:0.01em" id="htmlText">
        <h4>Hymnals</h4>
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>ShortName</th>
                    <th>Year</th>
                    <th>Number of Songs</th>
                    <th>Language</th>
                    <th>Link</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Seventh-Day Adventist Hymnal</td>
                    <td>SDAH</td>
                    <td>1985</td>
                    <td>695</td>
                    <td>English(en)</td>
                    <td><a href="/seventh-day-adventist-hymnal">Seventh-day Adventist Hymnal</a></td>
                </tr>
                <tr>
                    <td>Church Hymnal</td>
                    <td>CH1941</td>
                    <td>1941</td>
                    <td>703</td>
                    <td>English(en)</td>
                    <td><a href="/church-hymnal">Nyimbo za Kriso</a></td>
                </tr>
                <tr>
                    <td>Christ in Song</td>
                    <td>CS1908</td>
                    <td>1908</td>
                    <td>949</td>
                    <td>English(en)</td>
                    <td><a href="/christ-in-song">Christ in Song</a></td>
                </tr>
                <tr>
                    <td>Songs for Worship</td>
                    <td>SW</td>
                    <td>2000</td>
                    <td>0</td>
                    <td>English(en)</td>
                    <td><a href="/songs-for-worship">Songs for Worship</a></td>
                </tr>
                <tr>
                    <td>Millenial Harp</td>
                    <td>MH1843</td>
                    <td>1843</td>
                    <td>0</td>
                    <td>English(en)</td>
                    <td><a href="/millenial-harp">Millenial Harp</a></td>
                </tr>
                <tr>
                    <td>Nyimbo za Kristo</td>
                    <td>NZK</td>
                    <td>1985</td>
                    <td>220</td>
                    <td>Kiswahili(swh)</td>
                    <td><a href="/nyimbo-za-kristo">Nyimbo za Kriso</a></td>
                </tr>
                <tr>
                    <td>Wende Nyasaye</td>
                    <td>WN</td>
                    <td>1985</td>
                    <td>0</td>
                    <td>Luo(Luo)</td>
                    <td><a href="/wende-nyasaye">Wende Nyasaye</a></td>
                </tr>
            </tbody>
        </table>

        <div id="navigation">
            {{#navSlugs.prev}}<a class="nav nav-prev" href={{navSlugs.prev}}> <i
                    class="fa fa-chevron-left"></i></a>{{/navSlugs.prev}}

            {{#navSlugs.next}}<a class="nav nav-next" href={{navSlugs.next}}><i
                    class="fa fa-chevron-right"></i></a>{{/navSlugs.next}}
        </div>
    </div>
    <div id="q-app">

        <template>
            <!-- <q-layout view="lHh Lpr lFf"> -->
            <q-layout view="hHh lpR lff">
                <q-dialog v-model="showOld" transition-show="rotate" transition-hide="rotate">
                    <q-card>
                        <q-card-section>
                            <div id="yield" ref="yield">
                                {{{yield}}}
                            </div>
                        </q-card-section>
                    </q-card>
                </q-dialog>
                <q-dialog v-model="songYield" transition-show="rotate" transition-hide="rotate">
                    <q-card>
                        <q-card-section>
                            <div v-html="fetchedSong" ref="fetchedSong">
                            </div>
                        </q-card-section>
                    </q-card>
                </q-dialog>
                <q-header elevated>
                    <q-toolbar>
                        <q-btn flat dense round icon="menu" aria-label="Menu" @click="leftDrawerOpen = !leftDrawerOpen">
                        </q-btn>

                        <q-toolbar-title>
                            Advent Hymnals </q-toolbar-title>
                        <q-btn v-if="enableFullScreen" flat dense round :icon="fullscreenIcon" aria-label="Menu"
                            @click="fullscreen"></q-btn>
                    </q-toolbar>
                    <q-linear-progress indeterminate color="negative" v-if="loading" />
                </q-header>
                <q-drawer v-model="leftDrawerOpen" bordered class="bg-primary text-white" :breakpoint="2048"
                    content-class="bg-primary">
                    <q-list>
                        <q-item clickable @click="goto()">
                            <q-item-section side>
                                <q-icon color="white" name="home"></q-icon>
                            </q-item-section>
                            <q-item-section>Home</q-item-section>
                        </q-item>
                        <q-item v-for="hymnal in hymnals" clickable @click="openHymnalHard(hymnal)">
                            <q-item-section side>
                                <q-icon color="white" name="library_music"></q-icon>
                            </q-item-section>
                            <q-item-section>
                                <q-item-label>{{=<% %>=}}{{hymnal.name}}<%={{ }}=%></q-item-label>
                                <q-item-label caption class="text-accent">
                                    {{=<% %>=}}{{hymnal.language.replace(/\(.*/,'')}}<%={{ }}=%></q-item-label>
                            </q-item-section>
                        </q-item>
                        <q-separator color="white"></q-separator>
                        <q-item class="text-center text-accent">
                            <q-item-section>
                                <p class="q-pa-none q-ma-none">Built with <a href="https://csycms.csymapp.com"><strong
                                            class="text-white">csyms</strong></a> - A Flat File CMS for node</p>
                                {{#config.copyright}}
                                <p>Copyright &copy; {{{config.copyright.startYear}}} - {{{config.thisYear}}} <a
                                        href="{{{config.copyright.url}}}"><strong
                                            class="text-white">{{{config.copyright.name}}}</strong></a></p>
                                {{/config.copyright}}
                            </q-item-section>
                        </q-item>
                    </q-list>
                </q-drawer>

                <q-page-container>
                    <q-page class="bg-white">
                        <q-table ref="hymnals"
                            :title="`${Object.values(this.hymnals).map(item=>parseInt(item.numberofsongs)).reduce((a, b) => a+b, 0)} songs in ${languages.length} languages`"
                            :data="hymnals" :columns="columns" row-key="name" selection="multiple"
                            :selected.sync="selected" :rows-per-page-options="[0]" :filter="filter" grid hide-header
                            hide-bottom>
                            <template v-slot:top-right>
                                <q-input borderless dense debounce="300" v-model="filter" placeholder="Search Hymnal">
                                    <template v-slot:append>
                                        <q-icon name="search" />
                                    </template>
                                </q-input>

                            </template>
                            <template v-slot:top-left>
                                <div class="col-5"></div>
                                <q-select use-input filled v-model="language"
                                    :options="Object.values(languagesToSelect).map(item=>item.name)" :label="`language`"
                                    @input="selectLanguage">
                                    <template v-slot:prepend>
                                        <div>
                                            {{=<% %>=}}{{Object.values(hymnals).map(item=>parseInt(item.numberofsongs)).reduce((a, b) => a+b, 0)}}<%={{ }}=%>
                                            songs in
                                        </div>
                                    </template>
                                </q-select>
                            </template>

                            <template v-slot:item="props">
                                <div class="q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition"
                                    :style="!props.selected ? 'transform: scale(0.99);' : 'z-index:2'">
                                    <q-card
                                        :class="expanded ? 'bg-secondary text-white absolute-top' : 'bg-secondary text-white'">
                                        <q-btn round dense round :icon="props.selected?'close':'open_in_full'"
                                            :ref='`expand-${props.row.name}`' aria-label="Menu"
                                            :class="props.selected?'bg-red':'bg-green'"
                                            @click="props.selected = !props.selected; !props.selected?selectedHymnal=`${props.row.name}`:'';expanded=!expanded;hymnaSectionHeight_()"
                                            class="absolute-top-right q-ma-sm" style="z-index:5">
                                        </q-btn>
                                        <q-card-section class="text-center">
                                            {{=<% %>=}}{{props.row.name}}<%={{ }}=%>
                                            -{{=<% %>=}}{{props.row.year}}<%={{ }}=%>
                                        </q-card-section>
                                        <q-separator></q-separator>
                                        <q-card-section class="text-center row q-ma-none q-pa-none">
                                            <q-tabs v-model="tab" align="left" no-caps>
                                                <q-tab name="titles" label="Titles"></q-tab>
                                                <q-tab name="tunes" label="Tunes"></q-tab>
                                                <q-tab name="poets" label="Poets"></q-tab>
                                            </q-tabs>
                                        </q-card-section>

                                        <q-separator></q-separator>
                                        <q-card-section class="q-ma-none q-pa-none bg-accent"
                                            :style="(expanded && props.selected)?hymnaSectionHeightExpanded:hymnaSectionHeight">
                                            <q-tab-panels v-model="tab" animated
                                                class="bg-accent q-ma-none full-width q-pa-none">
                                                <q-tab-panel name="titles" class="q-ma-none q-pa-none">
                                                    <q-table :data="props.row.indices" :columns="titlesColumns"
                                                        :ref="`${props.row.name}-0`"
                                                        :visible-columns="titlesColumnsVisible" :dense="!expanded"
                                                        class="bg-transparent col hymnalSection" row-key="number"
                                                        :filter-method="filterSongFunc" :filter="filterSong"
                                                        :rows-per-page-options="rowsPerPage">
                                                        <template v-slot:top>
                                                            <q-input dense debounce="300" v-model="filterSong"
                                                                @keyup="filterBy=false"
                                                                placeholder="Search Title/First Line" class="col-12">
                                                                <template v-slot:append>
                                                                    <q-icon name="search" />
                                                                </template>
                                                            </q-input>
                                                        </template>
                                                        <template #body-cell-number="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="selectSong(props.row, propsi.row)">
                                                                {{=<% %>=}}{{propsi.row.number}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                        <template #body-cell-title="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="selectSong(props.row, propsi.row)">
                                                                {{=<% %>=}}{{propsi.row.title}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                        <template #body-cell-key="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="setFilter(propsi.row.key, 'key')">
                                                                {{=<% %>=}}{{propsi.row.key}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                    </q-table>
                                                </q-tab-panel>
                                                <q-tab-panel name="tunes" class="q-ma-none q-pa-none">
                                                    <q-table :dense="!expanded" :data="props.row.indices"
                                                        :columns="tunesColumns" class="bg-transparent col hymnalSection"
                                                        :filter="filterSong" row-key="number"
                                                        :rows-per-page-options="rowsPerPage"
                                                        :filter-method="filterSongFunc" :ref="`${props.row.name}-1`">
                                                        <template v-slot:top>
                                                            <q-input dense debounce="300" v-model="filterSong"
                                                                @keyup="filterBy=false" placeholder="Search Tune"
                                                                class="col-12">
                                                                <template v-slot:append>
                                                                    <q-icon name="search" />
                                                                </template>
                                                            </q-input>
                                                        </template>
                                                        <template #body-cell-tune="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="setFilter(propsi.row.tune, 'tune')">
                                                                {{=<% %>=}}{{propsi.row.tune}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                        <template #body-cell-metrical="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="setFilter(propsi.row.metrical, 'metrical')">
                                                                {{=<% %>=}}{{propsi.row.metrical}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                    </q-table>
                                                </q-tab-panel>
                                                <q-tab-panel name="poets" class="q-ma-none q-pa-none">
                                                    <q-table :dense="!expanded" :data="props.row.indices"
                                                        :columns="poetColumns" class="bg-transparent col hymnalSection"
                                                        :filter="filterSong" row-key="number"
                                                        :rows-per-page-options="rowsPerPage"
                                                        :filter-method="filterSongFunc" :ref="`${props.row.name}-2`">
                                                        <template v-slot:top>
                                                            <q-input dense debounce="300" v-model="filterSong"
                                                                @keyup="filterBy=false" placeholder="Search Poet"
                                                                class="col-12">
                                                                <template v-slot:append>
                                                                    <q-icon name="search" />
                                                                </template>
                                                            </q-input>
                                                        </template>
                                                        <template #body-cell-poet="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="setFilter(propsi.row.poet, 'poet')">
                                                                {{=<% %>=}}{{propsi.row.poet}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                        <template #body-cell-year="propsi">
                                                            <q-td class="cursor-pointer" :props="propsi"
                                                                @click="setFilter(propsi.row.year, 'year')">
                                                                {{=<% %>=}}{{propsi.row.year}}<%={{ }}=%>
                                                            </q-td>
                                                        </template>
                                                    </q-table>
                                                </q-tab-panel>
                                            </q-tab-panels>
                                        </q-card-section>
                                    </q-card>
                                </div>
                            </template>

                        </q-table>
                    </q-page>
                </q-page-container>

                <q-drawer bordered class="bg-primary" side="right" :width="rightSideBarSize" overlay :breakpoint="2"
                    v-model="rightSidebarOpen" behavior="desktop">
                    <q-linear-progress indeterminate color="negative" v-if="loading"></q-linear-progress>
                    <div v-if="hymnSidebar">
                        <q-toolbar class="bg-primary text-white">
                            <q-toolbar-title class="q-mt-md q-ml-md text-center">
                                <span class="text-caption"
                                    style="font-size: 0.4em">{{=<% %>=}}{{selectedSong.hymnal.shortname}}<%={{ }}=%>
                                </span><span
                                    class="text-weight-bold q-pt-lg">{{=<% %>=}}{{selectedSong.showTitle}}<%={{ }}=%></span><br />
                                <span class="text-caption"
                                    style="font-size: 0.8em">{{=<% %>=}}{{selectedSong.hymnal.name}}<%={{ }}=%></span>
                            </q-toolbar-title>
                            <q-btn flat round dense icon="close" @click="closeSelf" />
                        </q-toolbar>
                        <q-tabs v-model="songTab" align="left" no-caps>
                            <q-tab name="text" label="Text"></q-tab>
                            <q-tab name="sheet" label="Sheet Music"></q-tab>
                            <q-tab name="syllables" label="Syllables"></q-tab>
                        </q-tabs>

                        <q-tab-panels v-model="songTab" animated class="bg-accent q-ma-none full-width q-pa-none">
                            <q-tab-panel name="text" class="q-ma-none q-pa-none">
                                <q-card flat class="bg-accent text-center" style="font-size:3em; font-weight: bold;">
                                    <!-- <div class="absolute-top-left">tool</div>
                                    <q-card-section>
                                        toolbar
                                    </q-card-section> -->
                                    <q-card-section>
                                        <q-editor v-model="selectedLyrics" min-height="5rem" :toolbar="[
        [
          {
            label: $q.lang.editor.align,
            icon: $q.iconSet.editor.align,
            fixedLabel: true,
            options: ['left', 'center', 'right', 'justify']
          }
        ],
        ['bold', 'italic', 'strike', 'underline', 'subscript', 'superscript'],
        ['token', 'hr', 'link', 'custom_btn'],
        ['print', 'fullscreen'],
        [
          {
            label: $q.lang.editor.formatting,
            icon: $q.iconSet.editor.formatting,
            list: 'no-icons',
            options: [
              'p',
              'h1',
              'h2',
              'h3',
              'h4',
              'h5',
              'h6',
              'code'
            ]
          },
          {
            label: $q.lang.editor.fontSize,
            icon: $q.iconSet.editor.fontSize,
            fixedLabel: true,
            fixedIcon: true,
            list: 'no-icons',
            options: [
              'size-1',
              'size-2',
              'size-3',
              'size-4',
              'size-5',
              'size-6',
              'size-7'
            ]
          },
          {
            label: $q.lang.editor.defaultFont,
            icon: $q.iconSet.editor.font,
            fixedIcon: true,
            list: 'no-icons',
            options: [
              'default_font',
              'arial',
              'arial_black',
              'comic_sans',
              'courier_new',
              'impact',
              'lucida_grande',
              'times_new_roman',
              'verdana'
            ]
          },
          'removeFormat'
        ],
        ['quote', 'unordered', 'ordered', 'outdent', 'indent'],

        ['undo', 'redo'],
        ['viewsource']
      ]" :fonts="{
        arial: 'Arial',
        arial_black: 'Arial Black',
        comic_sans: 'Comic Sans MS',
        courier_new: 'Courier New',
        impact: 'Impact',
        lucida_grande: 'Lucida Grande',
        times_new_roman: 'Times New Roman',
        verdana: 'Verdana'
      }"></q-editor>
                                    </q-card-section>
                                    <q-card-section v-html="selectedLyrics">
                                    </q-card-section>
                                </q-card>
                            </q-tab-panel>
                            <q-tab-panel name="sheet" class="q-ma-none q-pa-none">Under Construction</q-tab-panel>
                            <q-tab-panel name="syllables" class="q-ma-none q-pa-none">Under Construction</q-tab-panel>
                        </q-tab-panels>
                    </div>
                </q-drawer>

            </q-layout>
        </template>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@^2.0.0/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@1.15.21/dist/quasar.umd.min.js"></script>
    <script>
        new Vue({
            el: '#q-app',
            data: function () {
                return {
                    filterBy: false,
                    showOld: false,
                    songYield: false,
                    songTab: 'text',
                    fetchedSong: 'text',
                    selectedSong: {},
                    selectedLyrics: '',
                    hymnSidebar: false,
                    rightSidebarOpen: false,
                    loading: false,
                    expanded: false,
                    hymnaSectionHeight: { height: `${300}px` },
                    hymnaSectionHeightExpanded: { height: `${300}px` },
                    selectedHymnal: '',
                    root: "{{config.base_url}}",
                    tab: 'titles',
                    enableFullScreen: true,
                    fullscreenIcon: "fullscreen",
                    leftDrawerOpen: false,
                    version: this.$q.version,
                    hymnals: [
                        { name: "Sventh-Day Adventist Hymnal", abbrev: "SDAH" }
                    ],
                    filter: '',
                    filterSong: '',
                    selected: [],
                    selectedLanguage: [],
                    language: "",
                    languages: [],
                    languagesToSelect: [],
                    allHymnals: [],
                    allHymnalsObj: {},
                    hymnals: [{}],
                    languageHymnals: [],
                    columns: [
                        { name: 'name', required: true, label: 'Hymnal', sortable: false, field: "name" },
                        { name: 'shortname', required: true, label: 'Abbvr', sortable: false, field: "shortname" },
                        { name: 'year', required: true, label: 'Year', sortable: false, field: "year" },
                        { name: 'numberofsongs', required: true, label: 'Number of Songs', sortable: true, field: "numberofsongs" },
                        { name: 'language', required: true, label: 'Language', sortable: false, field: "language" },
                        { name: 'link', required: true, label: 'Link', sortable: false, field: "link" },
                        { name: 'numResults', required: true, label: 'numResults', sortable: true, field: "numResults", sort: (a, b) => b - a }
                    ],
                    titlesColumns: [
                        { name: 'number', required: true, label: '#', sortable: true, field: "number" },
                        { name: 'title', required: true, label: 'Title', sortable: true, field: "title", align: 'left' },
                        { name: 'key', required: true, label: 'Key', sortable: true, field: "key" }
                    ],
                    titlesColumnsVisible: ["title", "key"],
                    //visible-columns
                    poetColumns: [
                        { name: 'number', required: true, label: '#', sortable: true, field: "number" },
                        { name: 'poet', required: true, label: 'Poet', sortable: true, field: "poet", align: 'left' },
                        { name: 'year', required: true, label: 'Year', sortable: true, field: "year" }
                    ],
                    tunesColumns: [
                        { name: 'number', required: true, label: '#', sortable: true, field: "number" },
                        { name: 'tune', required: true, label: 'Tune', sortable: true, field: "tune", align: 'left' },
                        { name: 'metrical', required: true, label: 'Metrical Pattern', sortable: true, field: "metrical" }
                    ],
                }
            },
            watch: {
                tab(val) {
                    setTimeout(() => {
                        let rowsPerPage = this.expanded ? 0 : 5
                        try {
                            this.$refs[`${this.selectedHymnal}-0`].setPagination({ rowsPerPage })
                        } catch (error) { }
                        try {
                            this.$refs[`${this.selectedHymnal}-1`].setPagination({ rowsPerPage })
                        } catch (error) { }
                        try {
                            this.$refs[`${this.selectedHymnal}-2`].setPagination({ rowsPerPage })
                        } catch (error) { }
                    }, 1000)
                }, expanded(val) {
                    this.hymnaSectionHeight_();
                },
                filterSong(terms) {
                    let cols = []
                    switch (this.tab) {
                        case 'titles':
                            cols = this.titlesColumns;
                            break;
                        case 'tunes':
                            cols = this.tunesColumns;
                            break;
                        case 'poets':
                            cols = this.poetColumns;
                            break;
                    }
                    this.hymnals.map((hymnal, index) => {
                        let rows = hymnal.indices
                        let numResults = rows.filter(row => {
                            let rowHasResult = false;
                            for (let col of Object.values(cols)) {
                                try {
                                    let hayStack = row[col.name].toString().replace(/ /g, '').replace(/[^a-zA-Z0-9#]/g, '').toLowerCase()
                                    let needle = terms.toLowerCase().replace(/ /g, '').replace(/[^a-zA-Z0-9#]/g, '')
                                    rowHasResult = hayStack.indexOf(needle)
                                    if (rowHasResult > -1) {
                                        return true
                                    }
                                } catch (error) { }
                            }
                            return false
                        }).length
                        this.hymnals[index].numResults = numResults
                    })
                    this.sortHymnals()
                },
                "$q.fullscreen.isActive"(val) {
                    this.isFullScreen = this.$q.fullscreen.isActive;
                    if (!this.isFullScreen) {
                        this.fullscreenIcon = "fullscreen";
                    } else {
                        this.fullscreenIcon = "fullscreen_exit";
                    }
                }
            },
            created() {
                this.getLocalHymnals();
                this.$q.notify({
                    type: "negative",
                    message: "This site is under heavy maintenance as the result of which some songs will be unavailable. Please check back in a few hours",
                })
            },
            computed: {
                rightSideBarSize() {
                    return this.$q.screen.lt.xs
                        ? document.getElementsByTagName("body")[0].clientWidth
                        : this.$q.screen.lt.sm
                            ? document.getElementsByTagName("body")[0].clientWidth
                            : this.$q.screen.lt.md
                                ? document.getElementsByTagName("body")[0].clientWidth
                                : document.getElementsByTagName("body")[0].clientWidth * 0.75;
                },
                rowsPerPage(props) {
                    // let rowsPerPage = props.selected.length > 0 ? 0 : 5
                    let rowsPerPage = this.expanded ? 0 : 5
                    try {
                        this.$refs[`${this.selectedHymnal}-0`].setPagination({ rowsPerPage })
                    } catch (error) { }
                    try {
                        this.$refs[`${this.selectedHymnal}-1`].setPagination({ rowsPerPage })
                    } catch (error) { }
                    try {
                        this.$refs[`${this.selectedHymnal}-2`].setPagination({ rowsPerPage })
                    } catch (error) { }
                    return {
                        rowsPerPage: [rowsPerPage]
                    }
                },
            },
            methods: {
                setFilter(filterSong, filterBy) {
                    console.log(filterSong, filterBy)
                    this.filterSong = filterSong
                    this.filterBy = filterBy
                },
                async selectSong(hymnal, hymn, reload) {
                    let { link } = hymnal
                    console.log(hymnal, hymn)
                    let { number, title } = hymn
                    number = parseInt(number)
                    // create the link
                    let hundreds = [];
                    let i = 0;
                    console.log(number, title, link)
                    while (i++ < number) {
                        hundreds.push([i, i += 99])
                    }
                    console.log(hundreds)
                    hundreds = hundreds.filter(item => item[0] <= number && number <= item[1])[0]
                    console.log(hundreds)
                    let tens = []
                    i = hundreds[0] - 1
                    while (i++ < hundreds[1]) {
                        tens.push([i, i += 9])
                    }
                    tens = tens.filter(item => item[0] <= number && number <= item[1])[0]
                    console.log(tens)
                    hundreds = hundreds.map(item => { item = item.toString(); while (item.length < 3) item = `0${item}`; return item }).join("-")
                    tens = tens.map(item => { item = item.toString(); while (item.length < 3) item = `0${item}`; return item }).join("-")
                    title = title.replace(/  /g, " ").replace(/ /g, "-").replace(/\?/g, '')
                    let url = `${this.root}/${link}/${hundreds}/${tens}/${title}`
                    if (reload) return window.location.assign(url)
                    let ret = false;
                    try {
                        this.loading = true;
                        console.log(url)
                        let tmp;
                        if (url === window.location.href) {
                            this.showOld = true
                            const wait = () => {
                                return new Promise((resolve)=>{
                                    setTimeout(()=>{
                                        resolve()
                                    },100)
                                })
                            }
                            await wait()    
                            ret = this.$refs.yield.innerHTML
                            this.showOld = false
                            tmp = ret
                        } else {
                            ret = (await axios.get(url)).data
                            tmp = ret.replace(/<div id="q-app">/g, '<div>')
                        }
                        this.loading = false;
                        this.fetchedSong = tmp;
                        this.songYield = false
                    } catch (err) {
                        this.$q.notify({
                            type: "negative",
                            message: "An error occured while fetching song"
                        })
                    }
                    try {
                        let yield = ret.match(/<section class="content">(([\s\S]*?))<\/section>/g)[0].replace(/<section class="content">/, '').replace(/<\/section>/, '');
                        let title = yield.match(/<h2>(.*)<\/h2>/)[1]
                        let lyrics = yield.match(/<code class="language-txt">(([\s\S]*?))<\/code>/g)[0].replace(/<[^>]*>/g, '')
                        this.selectedSong = { ...hymn }
                        this.selectedSong.hymnal = hymnal
                        this.selectedSong.showTitle = title;
                        this.selectedSong.lyrics = lyrics
                        this.selectedLyrics = lyrics.replace(/\n/g, '<br>')
                        console.log(this.selectedLyrics)
                    } catch (error) {

                        this.$q.notify({
                            type: "negative",
                            message: "An error occured while fetching song"
                        })
                    }

                    this.hymnSidebar = false;
                    this.rightSidebarOpen = false;
                    this.$nextTick(() => {
                        this.hymnSidebar = true;
                        this.rightSidebarOpen = true;
                    })
                },
                async selectSongHard(hymnal, hymn) {
                    await this.selectSong(hymnal, hymn, true)
                },
                closeSelf() {
                    this.rightSidebarOpen = false
                },
                goto(path) {
                    if (!path) path = this.root
                    window.location.assign(path)
                },
                closeSongs() {

                },
                openSong() { // from url or given hymnal and song
                    let urlParts = window.location.href.split(this.root)[1].match(/\/([0-9a-zA-Z\-]+)\/([0-9\-]+)\/([0-9\-]+)\/(.+)\/*/)
                    let link = urlParts[1]
                    let title = urlParts[4]
                    let hymnal = this.allHymnals.filter(item => item.link === link)[0]
                    let song = hymnal.indices.filter(item => { let ret = false; try { ret = item.title.replace(/  /g, " ").replace(/ /g, "-").replace(/\?/g, "") === title } catch (error) { }; return ret })[0]
                    this.selectSong(hymnal, song)
                },
                openHymnalHard(hymnal) {
                    let { name, link } = hymnal;
                    window.location.assign(`${this.root}/${link}`)
                },
                openHymnal(hymnal) {
                    let name, link;
                    if (typeof hymnal === 'object') {
                        link = hymnal.link
                        name = hymnal.name
                        let { name, link } = hymnal;
                    } else {
                        let urlParts = window.location.href.split(this.root)[1].match(/\/([0-9a-zA-Z\-]*)\/*/)
                        if (urlParts && urlParts[1]) {
                            hymnal = urlParts[1];
                            let isValidHymnal = this.hymnals.filter(item => item.link === hymnal).length > 0
                            if (!isValidHymnal) return false;
                        } else return false
                        urlParts = window.location.href.split(this.root)[1].match(/\/[0-9a-zA-Z\-]+\/([0-9\-]+)\/([0-9\-])+\/(.+)\/*/)
                        if (urlParts) return this.openSong();// open song rather than hymnal
                        link = hymnal
                        name = this.hymnals.filter(item => item.link === link)[0].name
                    }
                    this.$refs[`expand-${name}`].click();
                },
                hymnaSectionHeight_() {
                    setTimeout(() => {
                        if (this.expanded) {
                            return this.hymnaSectionHeightExpanded = { height: document.getElementsByTagName('body')[0].clientHeight + 'px' }
                        }
                        let height = 300;
                        let parts = document.getElementsByClassName("hymnalSection")
                        let heights = [];
                        try {
                            for (let i in parts) {
                                let part = parts[i]
                                heights.push(part.clientHeight)
                            }
                            heights = heights.sort((a, b) => b - a)
                            height = heights[0]
                        } catch (error) { }
                        this.hymnaSectionHeight = { height: `${height}px` }
                    }, 500)
                },
                filterSongFunc(rows, terms, cols, getCellValue) {
                    console.log(cols);
                    cols = Object.keys(rows[0]).map(item => { return { name: item } })
                    if (this.filterBy) cols = cols.filter(col => col.name === this.filterBy)
                    console.log(rows);
                    // console.log(cols);
                    rows = rows.filter(row => {
                        let rowHasResult = false;
                        for (let col of Object.values(cols)) {
                            try {
                                let hayStack = row[col.name].toString().replace(/ /g, '').replace(/[^a-zA-Z0-9#]/g, '').toLowerCase()
                                let needle = terms.toLowerCase().replace(/ /g, '').replace(/[^a-zA-Z0-9#]/g, '')
                                rowHasResult = hayStack.indexOf(needle)
                                if (rowHasResult > -1) {
                                    return true
                                }
                            } catch (error) { }
                        }
                        return false
                    })
                    this.hymnaSectionHeight_()
                    return rows
                },
                selectLanguage(lang) {
                    let langIndex = 0;
                    this.languagesToSelect.map((item, index) => {
                        if (item.name === lang) langIndex = index
                    });
                    this.hymnals = [... this.allHymnals]
                    this.filterOutEmptyHymnals()
                    if (langIndex > 0) this.hymnals = this.hymnals.filter(item => item.language === `${this.languagesToSelect[langIndex].name}(${this.languagesToSelect[langIndex].abbvr})`)
                    this.sortHymnals()
                },
                fullscreen() {
                    if (this.$q.fullscreen.isActive) {
                        this.$q.fullscreen.exit().then(() => { });
                    } else {
                        this.$q.fullscreen.request().then(() => { });
                    }
                },
                async getLocalHymnals() {
                    let dataTypes = document.getElementById("htmlText").innerHTML.match(/<h4>(([\s\S]*?))<\/h4>/g);
                    dataTypes = dataTypes.map(item => item.match(/>([^<]*)</)[1].toLowerCase())
                    let htmlData = document.getElementById("htmlText").innerHTML
                    let hymnalsData = htmlData.match(/<table[^>]*([\s\S]*?)(table>)/g)
                    let indexForHymnals = dataTypes.indexOf("hymnals");
                    let hymnalsTableData = hymnalsData[indexForHymnals]
                    let hymnalsTableDataTHeader = hymnalsTableData.match(/<thead>(([\s\S]*?))<\/thead>/g)[0].match(/<th>([^<]*)/g).map(item => item.match(/>(.*)/)[1].toLowerCase().replace(/ /g, ''))
                    let hymnalsTableDataTBody = hymnalsTableData.match(/<tbody>(([\s\S]*?))<\/tbody>/g)[0].match(/<tr>(([\s\S]*?))<\/tr>/g).map(item => item.match(/<td>([\s\S]*?)<\/td>/g).map(item => item.replace(/<td>/, '').replace(/<\/td>/, '')))
                    let langIndex = hymnalsTableDataTHeader.indexOf("language");
                    this.languages = [];
                    let tmpLangs = {}
                    hymnalsTableDataTBody.map(hymn => {
                        let lang = hymn[langIndex]
                        let langAbbvr = lang.match(/\((.*)\)/)[1]
                        let langName = lang.replace(/\(.*\)/, '')
                        tmpLangs[langName] = { name: langName, abbvr: langAbbvr }
                    })
                    Object.values(tmpLangs).map(lang => this.languages.push(lang))
                    let indices = { name: 0, shortname: 0, year: 0, numberofsongs: 0, language: 0, link: 0 };
                    for (let key in indices) indices[key] = hymnalsTableDataTHeader.indexOf(key)
                    this.hymnals = []
                    hymnalsTableDataTBody.map((hymn, index) => {
                        let tmpHymn = {}
                        for (let key in indices) {
                            tmpHymn[key] = hymn[indices[key]]
                        }
                        tmpHymn.link = encodeURI(tmpHymn.link.match(/href="(.*)"/)[1]).replace(/\/$/, '').replace(/^\//, '')
                        this.hymnals.push(tmpHymn)
                    })
                    this.allHymnals = [... this.hymnals]
                    this.allHymnals.map(item => this.allHymnalsObj[item.shortname] = item);
                    let abc = Object.values(this.hymnals).map(item => parseInt(item.numberofsongs)).reduce((a, b) => a + b, 0)
                    this.languagesToSelect = [... this.languages]
                    this.languagesToSelect.unshift({ name: `All ${this.languages.length} languages` })
                    this.language = this.languagesToSelect[0].name;

                    let paths = this.hymnals.map(item => item);

                    const fetchHymnsData = async (item) => {
                        return new Promise(async (resolve, reject) => {
                            let files = ["titles", "tunes", "poets", "metrical", "years", "keys"];
                            let ret = []
                            let retSingle;
                            let { link, shortname } = item;
                            let path = link
                            let promises = files.map(file => {
                                return new Promise(async (resolve, reject) => {
                                    let ret = false;
                                    try {
                                        ret = (await axios.get(`${this.root}/json/${path}/${file}.json`)).data
                                        resolve({ file, data: ret })
                                    } catch (err) {
                                        resolve({})
                                    }
                                })
                            })
                            for await (rets of promises) {
                                ret.push({ data: rets.data, path, file: rets.file, shortname })
                                this.allHymnalsObj[shortname][rets.file] = rets.data
                            }
                            resolve(ret)
                        })
                    }
                    let promises = paths.map(fetchHymnsData);
                    let results
                    try {
                        results = await Promise.all(promises)
                    } catch (error) {
                    }
                    this.hymnals = []
                    Object.values(this.allHymnalsObj).map(hymnalData => {
                        let tmpIndices = {}
                        for (let number in hymnalData.metrical) {
                            if (!tmpIndices[number]) tmpIndices[number] = {}
                            tmpIndices[number].metrical = hymnalData.metrical[number]
                        }
                        for (let number in hymnalData.poets) {
                            if (!tmpIndices[number]) tmpIndices[number] = {}
                            tmpIndices[number].poet = hymnalData.poets[number]
                        }
                        for (let number in hymnalData.tunes) {
                            if (!tmpIndices[number]) tmpIndices[number] = {}
                            tmpIndices[number].tune = hymnalData.tunes[number]
                        }
                        for (let number in hymnalData.years) {
                            if (!tmpIndices[number]) tmpIndices[number] = {}
                            tmpIndices[number].year = hymnalData.years[number]
                        }
                        for (let number in hymnalData.keys) {
                            if (!tmpIndices[number]) tmpIndices[number] = {}
                            tmpIndices[number].key = hymnalData.keys[number]
                        }
                        for (let number in hymnalData.titles) {
                            if (!tmpIndices[number]) tmpIndices[number] = {}
                            tmpIndices[number].title = hymnalData.titles[number].TITLES[0]
                            tmpIndices[number].firstLine = hymnalData.titles[number].FIRST_LINE
                            tmpIndices[number].otherTitles = hymnalData.titles[number].TITLES.join(",")
                            tmpIndices[number].number = number
                        }
                        this.allHymnalsObj[hymnalData.shortname].indices = Object.values(tmpIndices)
                        this.allHymnalsObj[hymnalData.shortname].numResults = Object.values(tmpIndices).length
                    })
                    Object.values(this.allHymnalsObj).map(hymnalData => this.hymnals.push(hymnalData))
                    this.allHymnals = [... this.hymnals]
                    this.filterOutEmptyHymnals()
                    this.sortHymnals();
                    this.hymnaSectionHeight_()
                    this.openHymnal();
                },
                filterOutEmptyHymnals() {
                },
                sortHymnals() {
                    this.hymnals = this.hymnals.sort((a, b) => b.numResults - a.numResults)
                }
            }
        })
    </script>
</body>

</html>